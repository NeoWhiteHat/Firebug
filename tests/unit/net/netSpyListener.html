<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");

var onStart = false;
var onLoad = false;

var prefOrigValue = Firebug.getPref(prefDomain, "showXMLHttpRequests");
Firebug.setPref(prefDomain, "showXMLHttpRequests", true);

var netSpyListener = 
{
    onStart: function(context, file) {
        fireunit.ok(!onStart, "onStart must be called just once");
        onStart = true;
    },

    onLoad: function(context, file) {
        fireunit.ok(!onLoad, "onLoad must be called just once");
        onLoad = true;
    }
}

Firebug.Spy.addListener(netSpyListener);

makeRequest("GET", "netSpyListener.txt", function(request)
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.netSpyListener.check callbacks from Firebug.Spy.");

    Firebug.Spy.removeListener(netSpyListener);

    fireunit.ok(onStart, "onStart callback verified");
    fireunit.ok(onLoad, "onLoad callback verified");

    Firebug.setPref(prefDomain, "showXMLHttpRequests", prefOrigValue);

    // Finish test
    FBTrace.sysout("fireunit.netSpyListener.DONE");
    fireunit.testDone();
});

</script>
</head>
<body>
<h1>Test for Firebug.Spy listener.</h1>
</body>
</html>
