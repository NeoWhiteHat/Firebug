<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="../env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");

request = new XMLHttpRequest();
request.onreadystatechange = function() {
    if (request.readyState == 4) {
        if (request.status == 200) {
            request.abort();
            delete request;
            setTimeout(function() {
                checkResponseTab();
            }, layoutTimeout);
        } 
    }
};
request.open("POST", "issue1275.txt", true);
request.send(null);

function checkResponseTab()
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.issue1275.checkResponseTab");

    // Open Firebug UI and activate Net panel.
    Firebug.showBar(true);
    FirebugChrome.selectPanel("net");

    // Expand the test request with params
    var panelNode = fireunit.panel("net");
    expandNetRows(panelNode, "netRow", "category-xhr", "hasHeaders", "loaded");
    expandNetTabs(panelNode, "netInfoResponseTab");

    // The response must be displayed.
    var responseBody = FBL.getElementByClass(panelNode, "netInfoResponseText", "netInfoText");
    fireunit.compare("{ data1: 'value1', data2: 'value2' }", 
        responseBody.textContent, "Test JSON response must match.");

    // Finish test
    FBTrace.sysout("fireunit.issue1275.DONE");
    fireunit.testDone();
}
</script>
</head>
<body>
<h1>Test for Issue #1275</h1>
</body>
</html>
