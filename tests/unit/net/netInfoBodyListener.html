<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");

var initTabBody = false;
var updateTabBody = false;
var destroyTabBody = false;

var netInfoBodyListener = 
{
    initTabBody: function(infoBox, file) {
        initTabBody = true;
    },

    updateTabBody: function(infoBox, file, context) {
        updateTabBody = true;
    },

    destroyTabBody: function(infoBox, file) {
        destroyTabBody = true;
    }
}

var NetInfoBody = Firebug.NetMonitor.NetInfoBody;

// Ability to register a listener in NetInfoBody has been introduced since Firebug 1.4
if ("addListener" in NetInfoBody) {
    NetInfoBody.addListener(netInfoBodyListener);
    makeRequest("GET", "netInfoBodyListener.txt", function(request)
    {
        enablePrivilege("UniversalXPConnect");
        FBTrace.sysout("fireunit.netInfoBodyListener.check callbacks from Firebug.NetMonitor.NetInfoBody.");

        Firebug.showBar(true);
        FirebugChrome.selectPanel("net");

        // Get test request row.
        var panelNode = fireunit.panel("net");
        var netRow = FBL.getElementByClass(panelNode, "netRow", "category-xhr", "hasHeaders", "loaded");

        // Click to open + click to close.
        fireunit.click(netRow);
        fireunit.click(netRow);

        NetInfoBody.removeListener(netInfoBodyListener);

        fireunit.ok(initTabBody, "initTabBody callback verified");
        fireunit.ok(updateTabBody, "updateTabBody callback verified");
        fireunit.ok(destroyTabBody, "destroyTabBody callback verified");

        // Finish test
        FBTrace.sysout("fireunit.netInfoBodyListener.DONE");
        fireunit.testDone();
    });
}
else {
    fireunit.testDone();
}

</script>
</head>
<body>
<h1>Test for Firebug.NetMonitor.NetInfoBody listener.</h1>
</body>
</html>
